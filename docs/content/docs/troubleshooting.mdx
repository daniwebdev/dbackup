---
title: Troubleshooting
description: Common issues and solutions for DBackup
---

# Troubleshooting Guide

Solutions for common DBackup issues and problems.

## Installation Issues

### "pg_dump: command not found"

**Problem:** PostgreSQL client tools (`pg_dump`) are not installed or not in PATH.

**Solution:**

<Callout title="Install Database Tools" type="warning">
You must install PostgreSQL client tools on your system:

- **macOS**: `brew install postgresql`
- **Ubuntu/Debian**: `sudo apt-get install postgresql-client`
- **RHEL/CentOS**: `sudo yum install postgresql`
- **Alpine**: `apk add postgresql-client`

Ensure the tool is accessible in your system PATH.
</Callout>

---

### "rustc: command not found"

**Problem:** Rust is not installed.

**Solution:**

```bash
# Install Rust using rustup
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Reload shell
source $HOME/.cargo/env

# Verify
rustc --version
```

---

### Build Fails with Linker Errors

**Problem:** Missing dependencies or linker issues.

**Solution (macOS):**
```bash
# Install OpenSSL
brew install openssl

# Set environment variables
export LDFLAGS="-L/usr/local/opt/openssl/lib"
export CPPFLAGS="-I/usr/local/opt/openssl/include"

# Rebuild
cargo build --release
```

**Solution (Linux):**
```bash
# Install development tools
sudo apt-get install build-essential pkg-config libssl-dev

# Rebuild
cargo build --release
```

---

## Configuration Issues

### "Configuration error: Invalid connection settings"

**Problem:** Database connection information is wrong.

**Solution:**

1. **Verify credential details:**
   ```bash
   # Test PostgreSQL connection
   psql -h localhost -p 5432 -U postgres -d template1 -c "SELECT version();"
   ```

2. **Check YAML syntax:**
   ```bash
   # Validate YAML structure
   dbackup validate -c backup.yml
   ```

3. **Common mistakes:**
   - Wrong port number (PostgreSQL: 5432, MySQL: 3306)
   - Typo in username or password
   - Incorrect database name
   - Wrong hostname

**Example fix:**
```yaml
connection:
  host: localhost        # Check spelling
  port: 5432            # Check port
  username: postgres    # Check username
  password: ${DB_PASSWORD}  # Check if environment variable exists
  database: mydb
```

---

### "YAML parsing error"

**Problem:** Syntax error in YAML configuration.

**Solution:**

Check common YAML issues:
- Indentation must be spaces (not tabs)
- Keys and values must be properly aligned
- Strings with special characters must be quoted

**Validate:**
```bash
dbackup validate -c backup.yml
```

**Example error and fix:**

❌ Wrong (spaces vs tabs):
```yaml
backups:
	- name: "My Database"  # Tab instead of spaces
```

✅ Correct:
```yaml
backups:
  - name: "My Database"  # Spaces only
```

---

### Storage Path Doesn't Exist

**Problem:** Backup directory doesn't exist.

**Solution:**

```bash
# Create backup directory
mkdir -p /var/backups/postgresql

# Set proper permissions
sudo chown $USER:$USER /var/backups/postgresql
chmod 755 /var/backups/postgresql

# Verify
ls -ld /var/backups/postgresql
```

---

## Connection Issues

### "Connection refused" or "Could not connect"

**Problem:** Can't connect to the database.

**Solution Checklist:**

1. **Is the database running?**
   ```bash
   # For PostgreSQL
   sudo systemctl status postgresql
   sudo service postgresql status
   
   # For MySQL
   sudo systemctl status mysql
   sudo service mysql status
   ```

2. **Can you connect manually?**
   ```bash
   # PostgreSQL
   psql -h localhost -U postgres -d template1 -c "SELECT 1;"
   
   # MySQL
   mysql -h localhost -u root -p -e "SELECT 1;"
   ```

3. **Check hostname/port:**
   ```bash
   # Check if port is open
   netstat -tuln | grep 5432    # PostgreSQL
   netstat -tuln | grep 3306    # MySQL
   
   # Or use nc (netcat)
   nc -zv localhost 5432
   ```

4. **Fix hostname/port in config:**
   ```yaml
   connection:
     host: localhost      # Try "127.0.0.1" if localhost doesn't work
     port: 5432          # Verify correct port
   ```

---

### "Password authentication failed"

**Problem:** Authentication error with database.

**Solution:**

1. **Verify password:**
   ```bash
   # Test with psql
   psql -h localhost -U postgres -c "SELECT 1;"
   ```

2. **Check password in config:**
   ```yaml
   connection:
     username: postgres
     password: your_actual_password  # Not the placeholder
   ```

3. **Use environment variable** (recommended):
   ```bash
   export DB_PASSWORD="your_password"
   ```

   In config:
   ```yaml
   connection:
     password: ${DB_PASSWORD}
   ```

4. **Fix pg_hba.conf** (PostgreSQL):
   ```bash
   # Edit PostgreSQL config
   sudo nano /etc/postgresql/*/main/pg_hba.conf
   
   # Look for line like:
   # host    all             all             127.0.0.1/32            md5
   
   # Restart PostgreSQL
   sudo systemctl restart postgresql
   ```

---

## Backup Execution Issues

### Backup Runs but Takes Too Long

**Problem:** Backup process is slow.

**Solution:**

1. **Check database size:**
   ```bash
   psql -U postgres -d mydb -c "SELECT pg_size_pretty(pg_database_size('mydb'));"
   ```

2. **Switch to parallel mode** (if database is > 1 GB):
   ```yaml
   mode: parallel
   parallel_jobs: 4
   ```

3. **Check system resources:**
   ```bash
   # Monitor during backup
   watch -n 1 'top -b -n 1 | head -15'
   df -h
   ```

4. **Run backup during off-peak hours:**
   ```yaml
   schedule:
     cron: "0 2 * * *"  # 2 AM (lower traffic)
   ```

---

### "No space left on device"

**Problem:** Disk is full during backup.

**Solution:**

1. **Check disk space:**
   ```bash
   df -h /var/backups/postgresql/
   
   # Check what's taking space
   du -sh /var/backups/postgresql/*
   ```

2. **Clean old backups:**
   ```bash
   # Remove oldest backup
   ls -lrt /var/backups/postgresql/ | head -1
   rm /var/backups/postgresql/backup_20260101_*.dump.gz
   ```

3. **Enable retention policy:**
   ```yaml
   retention: "30d"  # Auto-delete after 30 days
   ```

4. **Use cloud storage (S3):**
   ```yaml
   storage:
     ref: s3_backups
   ```

---

### "Broken pipe" or "Connection lost"

**Problem:** Connection to database drops during backup.

**Solution:**

1. **Check network stability:**
   ```bash
   ping database.host.com
   traceroute database.host.com
   ```

2. **Reduce parallel jobs** (if remote database):
   ```yaml
   parallel_jobs: 2  # Reduce from 4
   ```

3. **Increase timeout** (in pg_dump, if supported):
   ```bash
   # Try basic mode first
   mode: basic
   ```

4. **Run during low-traffic times:**
   ```yaml
   schedule:
     cron: "0 2 * * *"
   ```

---

## Storage Issues

### S3 Connection Fails

**Problem:** Can't connect to S3 or S3-compatible service.

**Solution:**

1. **Test AWS credentials:**
   ```bash
   # List buckets
   aws s3 ls

   # Or set specific credentials
   export AWS_ACCESS_KEY_ID="AKIA..."
   export AWS_SECRET_ACCESS_KEY="wJal..."
   export AWS_DEFAULT_REGION="us-east-1"
   aws s3 ls
   ```

2. **Check bucket exists:**
   ```bash
   aws s3 ls s3://my-bucket --region us-east-1
   ```

3. **Verify configuration:**
   ```yaml
   storage:
     driver: s3
     bucket: my-bucket           # Check spelling
     region: us-east-1           # Correct region
     endpoint: ""                # Only for S3-compatible
   ```

4. **Check IAM permissions:**
   ```json
   {
     "Effect": "Allow",
     "Action": [
       "s3:PutObject",
       "s3:GetObject",
       "s3:DeleteObject",
       "s3:ListBucket"
     ],
     "Resource": [
       "arn:aws:s3:::my-bucket",
       "arn:aws:s3:::my-bucket/*"
     ]
   }
   ```

---

### S3 "Access Denied"

**Problem:** S3 authentication or permissions error.

**Solution:**

1. **Verify credentials:**
   ```bash
   aws s3 ls --region us-east-1
   ```

2. **Check IAM policy:**
   - Ensure access key has S3 permissions
   - Verify bucket is accessible
   - Check bucket policy (if private)

3. **For S3-compatible services:**
   ```yaml
   storage:
     access_key_id: minioadmin     # Check credentials
     secret_access_key: minioadmin
     endpoint: http://minio:9000   # Check endpoint
   ```

---

### "Bucket not found"

**Problem:** S3 bucket doesn't exist or is inaccessible.

**Solution:**

```bash
# List your buckets
aws s3 ls

# If bucket doesn't exist, create it
aws s3api create-bucket \
  --bucket my-backups \
  --region us-east-1 \
  --create-bucket-configuration LocationConstraint=us-east-1
```

---

## Scheduled Backup Issues

### Scheduled Backups Not Running

**Problem:** Cron schedule not executing.

**Solution:**

1. **Check if daemon is running:**
   ```bash
   # If using systemd
   sudo systemctl status dbackup.service
   
   # If running manually
   ps aux | grep "dbackup run"
   ```

2. **Verify cron expression:**
   ```bash
   # Validate config
   dbackup validate -c backup.yml
   
   # Test cron manually
   # Use online cron validator: crontab.guru
   # Example: "0 2 * * *" = Every day at 2 AM
   ```

3. **Check system time:**
   ```bash
   # Verify time synchronization
   timedatectl
   date
   
   # Check timezone
   date +%Z
   ```

4. **Check logs:**
   ```bash
   # Systemd journal
   journalctl -u dbackup.service -f
   
   # Or manual log
   tail -f /var/log/dbackup.log
   ```

5. **Test manually:**
   ```bash
   # Run manually to verify it works
   dbackup backup -c backup.yml -n "Your Backup Name"
   ```

---

### Backup Running at Wrong Time

**Problem:** Scheduled backup runs at unexpected times.

**Solution:**

1. **Verify cron expression syntax:**
   - `0 2 * * *` = 2:00 AM daily
   - `0 0 * * 0` = Sunday midnight
   - Use online validator: [crontab.guru](https://crontab.guru)

2. **Check system timezone:**
   ```bash
   timedatectl
   # Should show your local timezone
   ```

3. **Common mistakes:**
   - Forgetting hours are 0-23 (not 1-12)
   - Confusing minute and hour positions
   - Forgetting day of week (0=Sunday, 6=Saturday)

---

## Restoration Issues

### Restore Hangs or Stalls

**Problem:** Restore process doesn't complete.

**Solution:**

1. **Press Ctrl+C to stop:**
   ```bash
   # Try restoring with limited data first
   pg_restore -U postgres -d mydb -t table_name backup_*.dump.gz
   ```

2. **Try without indexes:**
   ```bash
   pg_restore -U postgres -d mydb --no-indexes backup_*.dump.gz
   ```

3. **Check available resources:**
   ```bash
   df -h  # Disk space
   free -h  # Memory
   ```

---

### "Database already exists"

**Problem:** Can't restore because database name is taken.

**Solution:**

```bash
# Create restore with different name
pg_restore -U postgres -d mydb_restored backup_*.dump.gz

# Then either:
# 1. Rename database
# 2. Drop original and rename restored
psql -U postgres -c "DROP DATABASE mydb;"
psql -U postgres -c "ALTER DATABASE mydb_restored RENAME TO mydb;"
```

---

### Restore Fails with Permission Error

**Problem:** Permission denied during restore.

**Solution:**

```bash
# Check PostgreSQL superuser access
psql -U postgres -d template1 -c "SELECT 1;"

# Ensure restore user has CREATE privilege
psql -U postgres -c "ALTER USER restoreuser CREATEDB;"

# Try restore with superuser
pg_restore -U postgres -d mydb backup_*.dump.gz
```

---

## Performance Issues

### High Memory Usage

**Problem:** Backup or daemon uses excessive memory.

**Solution:**

1. **Reduce parallel jobs:**
   ```yaml
   parallel_jobs: 2  # Reduce from 4
   ```

2. **Reduce concurrency:**
   ```bash
   dbackup run -c backup.yml --concurrency 1
   ```

3. **Monitor memory:**
   ```bash
   watch -n 1 'ps aux | grep dbackup'
   ```

---

### High CPU Usage (Expected)

**Problem:** CPU usage is high during backup.

**Note:** This is **expected** during backups. Parallel backups use multiple cores intentionally.

**Solutions if needed:**

1. **Reduce parallel jobs:**
   ```yaml
   parallel_jobs: 2
   ```

2. **Schedule during off-peak:**
   ```yaml
   schedule:
     cron: "0 2 * * *"  # 2 AM
   ```

3. **Limit CPU quota** (systemd):
   ```ini
   [Service]
   CPUQuota=50%  # Limit to 50% of one core
   ```

---

## Logging & Debugging

### Enable Debug Logging

```bash
# For single command
RUST_LOG=debug dbackup backup -c backup.yml

# For systemd service
sudo systemctl edit dbackup.service
# Change Environment="RUST_LOG=debug"
sudo systemctl restart dbackup.service
journalctl -u dbackup.service -f
```

### Verbose Output

```bash
# Show all details
RUST_LOG=trace dbackup backup -c backup.yml -n "Your Backup"

# Levels: error, warn, info, debug, trace
```

---

## Getting Help

### Collect Diagnostic Information

When reporting issues, gather:

```bash
# System info
uname -a
dbackup --version
pg_dump --version

# Configuration (sanitized)
cat /etc/dbackup/backup.yml | grep -v password

# Recent logs
journalctl -u dbackup.service -n 100

# Disk space
df -h /var/backups/postgresql/

# Process info
ps aux | grep dbackup
```

### Common Resources

- **DBackup Docs:** `/docs`
- **PostgreSQL Docs:** https://www.postgresql.org/docs/
- **Systemd Docs:** https://systemd.io/
- **Stack Overflow:** Tag `dbackup` or `postgresql`

---

<Callout title="Still Need Help?" type="info">
Check [CLI Reference](/docs/cli-reference) for command options and [Getting Started](/docs/getting-started) for setup walkthrough.
</Callout>
